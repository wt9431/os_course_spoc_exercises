#lec 3 SPOC Discussion

## 第三讲 启动、中断、异常和系统调用-思考题

## 3.1 BIOS
 1. 比较UEFI和BIOS的区别。
 
 - UEFI是BIOS的一种升级替代方案。BIOS用于加载电脑最基本的程序码，负责在开机时初始化硬件、检测硬件功能以及引导操作系统。而UEFI用于操作系统自动从预启动的操作环境加载到一种操作系统上，从而使得开机程序化繁为简节省时间。UEFI通过保护预启动或预引导进程抵御bootkit攻击，安全性更高；启动时间较BIOS更短；比BIOS的兼容性更好。
 
 1. 描述PXE的大致启动流程。
 
 - 1 通过UDP协议发送受限广播(255.255.255.255),目标端口67, 是DHCP命令中的DHCP discover,带PXEClient标志,并在UDP 68端口监听。
 - 2 DHCP服务器在67端口收到请求后,通过UDP协议发送受限广播(255.255.255.255)，目标端口68,是DHCP命令中的DHCPoffer,附带客户端ip,网关,tftp服务器ip,子网掩码,可引导的文件名等.
 - 3 客户机在68端口收到服务器回复的信息,客户机配置自身ip，从此时起，客户机可以使用单播通讯了。
 - 4 客户端通过tftp协议发送获取引导文件的命令,并将获取的引导文件存放在地址 0:7c00 （第3步中获取的引导文件名）.
 - 5.跳转到0:7c00开始执行引导文件中的代码,从此时起cpu控制权己交给引导文件.
    
## 3.2 系统启动流程
 1. 了解NTLDR的启动流程。

 - 1 电源自检程序开始运行
 - 2 主引导记录被装入内存，并且程序开始执行
 - 3 活动分区的引导扇区被装入内存
 - 4 NTLDR从引导扇区被装入并初始化
 - 5 将处理器的实模式改为32位平滑内存模式
 - 6 NTLDR开始运行适当的小文件系统驱动程序。小文件系统驱动程序是建立在NTLDR内部的，它能读FAT或NTFS。
 - 7 NTLDR读boot.ini文件
 - 8 NTLDR装载所选操作系统。如果windows NT/windows 2000/windows XP/windows server2003这些操作系统被选择，NTLDR运行
Ntdetect。对于其他的操作系统，NTLDR装载并运行Bootsect.dos然后向它传递控制。windows NT过程结束。
 - 9 Ntdetect搜索计算机硬件并将列表传送给NTLDR，以便将这些信息写进\\HKE Y_LOCAL_MACHINE\HARDWARE中。
 - 10 然后NTLDR装载Ntoskrnl.exe，Hal.dll和系统信息集合。
 - 11 Ntldr搜索系统信息集合，并装载设备驱动配置以便设备在启动时开始工作
 - 12 Ntldr把控制权交给Ntoskrnl.exe，这时,启动程序结束,装载阶段开始
    
 1. 了解GRUB的启动流程。
 
 - BIOS的任务完成后，将系统启动的控制权移交到MBR部分的代码。
 - 1.装载stage1
 - 2.装载stage1.5
 - 3.装载stage2
 - 4.读取/boot/grub.conf文件并显示启动菜单
 - 5.装载所选的kernel和initrd文件到内存中
 
 1. 比较NTLDR和GRUB的功能有差异。
 
 - NTLDR是xp之前的windows系统的引导文件，只能装在硬盘
 - GRUB是第三方操作系统引导器，可以引导硬盘、光盘、网络、u盘、winxp、winpe、win7、linux、dos....
    
 1. 了解u-boot的功能。
 
 - 1.初始化处理器及外围的硬件资源，配置SDRAM控制器，为主程序提供运行环境，串口初始化，提供交互终端网络，传输镜像文件及其他I/O设备。
 - 2.执行系统自检，报告检测结果。
 - 3.引导操作系统
 - 4.根据系统命令烧写惊醒文件
    
## 3.3 中断、异常和系统调用比较
 1. 什么是中断、异常和系统调用？
 
 2. 中断、异常和系统调用的处理流程有什么异同？
 2. 举例说明Linux中有哪些中断，哪些异常？
 3. 以ucore lab8的answer为例，uCore的时钟中断处理流程。

 1. Linux的系统调用有哪些？大致的功能分类有哪些？  (w2l1)

 - linux的系统调用大概有250个，主要分为进程控制、文件操作、系统控制、内存管理、网络管理、用户管理、进程间通信这几类
 
 1. 以ucore lab8的answer为例，uCore的系统调用有哪些？大致的功能分类有哪些？(w2l1)
 
 - ucore的系统调用有22个，大致的功能分类有进程控制、文件操作、系统控制、内存管理、用户管理。
 
## 3.4 linux系统调用分析
 1. 通过分析[lab1_ex0](https://github.com/chyyuu/ucore_lab/blob/master/related_info/lab1/lab1-ex0.md)了解Linux应用的系统调用编写和含义。(w2l1)
 
 - objdump的作用是反汇编目标文件，nm的作用是显示一个目标文件中的所有符号，file的作用是查看文件类型。
 - 系统调用是linux内核中设置的一组用于实现系统功能的子程序，通过系统调用，应用程序可以访问硬件设备和其他操作系统资源，使得内核可以和用户空间上运行的进程进行交互，并且保证系统稳定可靠。

 
 1. 通过调试[lab1_ex1](https://github.com/chyyuu/ucore_lab/blob/master/related_info/lab1/lab1-ex1.md)了解Linux应用的系统调用执行过程。(w2l1)
 
 - strace可以跟踪到一个进程产生的系统调用,包括参数，返回值，执行消耗的时间。
 - 用户程序中执行系统调用，先通过调用C库中的函数，这个函数里面有软中断INT 0x80语句，这条指令的执行会让系统跳转到一个预设的内核空间地址，它指向系统调用处理程序，即system_call函数。INT 0x80指令执行时，系统调用号会被放入eax寄存器中，
 - system_call函数可以读取eax寄存器，然后将其乘以4,生成偏移地址，然后以sys_call_table为基址，基址加上偏移地址，就可以得到具体的系统调用服务例程的地址了。当系统调用完成后，把控制权交回到发起调用的用户进程前，内核会有一次调度。如果发现有优先级更高的进程或当前进程的时间片用完，那么会选择优先级更高的进程或重新选择进程执行。

 
## 3.5 ucore系统调用分析
 1. ucore的系统调用中参数传递代码分析。
 1. 以getpid为例，分析ucore的系统调用中返回结果的传递代码。
 1. 以ucore lab8的answer为例，分析ucore 应用的系统调用编写和含义。
 1. 以ucore lab8的answer为例，尝试修改并运行ucore OS kernel代码，使其具有类似Linux应用工具`strace`的功能，即能够显示出应用程序发出的系统调用，从而可以分析ucore应用的系统调用执行过程。
 
## 3.6 请分析函数调用和系统调用的区别
 1. 请从代码编写和执行过程来说明。
   1. 说明`int`、`iret`、`call`和`ret`的指令准确功能
 

## v9-cpu相关题目
---

### 提前准备
```
cd YOUR v9-cpu DIR
git pull 
cd YOUR os_course_spoc_exercise DIR
git pull 
```

### v9-cpu系统调用实现
  1. v9-cpu中os4.c的系统调用中参数传递代码分析。
  1. v9-cpu中os4.c的系统调用中返回结果的传递代码分析。
  1. 理解v9-cpu中os4.c的系统调用编写和含义。
